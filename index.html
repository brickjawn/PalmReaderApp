<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mystic Palm & Elements</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Cormorant+Garamond:wght@400;500;600;700&display=swap');
        
        :root {
            --primary: #7C3AED;
            --primary-light: #8B5CF6;
            --primary-dark: #6D28D9;
            --secondary: #475569;
            --accent: #F59E0B;
            --background: #F8FAFC;
            --card: #FFFFFF;
            --text-primary: #1E293B;
            --text-secondary: #64748B;
            --border: #E2E8F0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            position: relative;
        }

        /* Trippy animated background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57, #ff9ff3, #54a0ff);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }

        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: 
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(120, 255, 198, 0.3) 0%, transparent 50%);
            animation: floatingOrbs 20s ease-in-out infinite;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes floatingOrbs {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(30px, -30px) rotate(120deg); }
            66% { transform: translate(-20px, 20px) rotate(240deg); }
        }

        .font-display {
            font-family: 'Cormorant Garamond', serif;
        }

        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 2rem 1rem;
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .card {
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 1.5rem;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
            text-align: center;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .button {
            background-color: var(--primary);
            color: white;
            font-weight: 500;
            padding: 0.875rem 1.75rem;
            border-radius: 0.75rem;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-block;
            width: 100%;
            margin-top: 1rem;
            font-size: 1rem;
            letter-spacing: 0.025em;
        }

        .button:hover {
            background-color: var(--primary-dark);
            transform: translateY(-1px);
        }

        .button:active {
            transform: translateY(0);
        }

        .button-secondary {
            background-color: var(--secondary);
            color: white;
        }

        .button-secondary:hover {
            background-color: #334155;
        }

        .tab-button {
            background-color: transparent;
            color: var(--text-secondary);
            font-weight: 500;
            padding: 0.75rem 1.25rem;
            border-radius: 0.75rem;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 0 0.375rem;
            font-size: 0.9375rem;
        }

        .tab-button.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .tab-button:hover:not(.active) {
            background-color: var(--background);
            border-color: var(--primary);
            color: var(--primary);
        }

        .hidden {
            display: none !important;
        }

        label {
            display: block;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
            text-align: left;
            font-size: 0.9375rem;
        }

        input[type="file"] {
            border: 2px dashed var(--border);
            padding: 1.5rem;
            border-radius: 1rem;
            cursor: pointer;
            display: block;
            width: 100%;
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            transition: all 0.2s ease;
        }

        input[type="file"]:hover {
            border-color: var(--primary);
            background-color: rgba(124, 58, 237, 0.05);
        }

        input[type="file"]::file-selector-button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 0.625rem 1.25rem;
            border-radius: 0.5rem;
            cursor: pointer;
            margin-right: 0.75rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        input[type="file"]::file-selector-button:hover {
            background-color: var(--primary-dark);
        }

        #palmImagePreview, #analyzingPalmImageDisplay, #readingPalmImage {
            max-width: 100%;
            max-height: 300px;
            border-radius: 1rem;
            margin: 1.5rem auto;
            display: block;
            border: 1px solid var(--border);
            object-fit: contain;
        }

        .reading-text {
            text-align: left;
            color: var(--text-primary);
        }

        .reading-text p {
            margin-bottom: 1rem;
            line-height: 1.75;
            color: var(--text-secondary);
        }

        .reading-text strong, .reading-text h4 {
            color: var(--text-primary);
            font-weight: 600;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
        }

        select {
            width: 100%;
            padding: 0.875rem;
            border-radius: 0.75rem;
            border: 1px solid var(--border);
            margin-bottom: 1.5rem;
            background-color: white;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.2s ease;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236B7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1.5em;
            padding-right: 2.5rem;
        }

        select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
        }

        .scan-container {
            position: relative;
            display: inline-block;
            border-radius: 1rem;
            overflow: hidden;
        }

        .scan-line {
            position: absolute;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
            box-shadow: 0 0 15px var(--primary);
            animation: scan-anim 3s ease-in-out infinite;
            border-radius: 2px;
        }

        @keyframes scan-anim {
            0% { top: 0%; opacity: 0.5; }
            50% { opacity: 1; }
            100% { top: 100%; opacity: 0.5; }
        }

        .loader {
            border: 3px solid var(--border);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 48px;
            height: 48px;
            animation: spin 1s linear infinite;
            margin: 1.5rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--background);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div id="welcomeScreen" class="card">
            <h1 class="text-3xl font-display font-bold text-gray-800 mb-4">Mystic Palm & Elements</h1>
            <p class="text-gray-600 mb-6">Unveil the secrets held within your hand and the cosmos. Upload a picture of your palm to begin your journey.</p>
            <button id="startScanButton" class="button">Begin Your Reading</button>
        </div>

        <div id="uploadScreen" class="card hidden">
            <h2 class="text-2xl font-display font-semibold text-gray-700 mb-4">Upload Your Palm Images</h2>
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
                <p class="text-yellow-800">
                    <span class="font-semibold">💫 Complete Reading Required:</span> 
                    For a full and accurate reading, you'll need to upload both your left and right hands. The left hand reveals your inherent traits, while the right hand shows your current path.
                </p>
            </div>

            <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-6">
                <h3 class="text-blue-800 font-medium mb-2">📸 Quick Tips</h3>
                <div class="text-xs text-blue-700 grid grid-cols-2 gap-1">
                    <div>• Good lighting</div>
                    <div>• Palm flat & steady</div>
                    <div>• Wrist to fingertips</div>
                    <div>• Sharp focus</div>
                </div>
            </div>

            <div class="flex gap-4 mb-6">
                <div class="flex-1 p-4 border-2 border-gray-200 rounded-lg flex flex-col">
                    <h3 class="font-display text-lg mb-2">Left Hand</h3>
                    <p class="text-sm text-gray-500 mb-4">Your potential & inherited traits</p>
                    <div class="relative mb-2 flex-grow">
                        <img id="leftHandPreview" src="#" alt="Left Palm Preview" class="hidden w-full h-48 object-contain rounded-lg border border-gray-200"/>
                        <button id="removeLeftImageButton" class="absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full shadow-lg hidden hover:bg-red-600 transition-colors" aria-label="Remove left hand image">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <input type="file" id="leftHandInput" accept="image/*" class="hidden">
                    <button onclick="document.getElementById('leftHandInput').click()" class="button button-secondary w-full mt-auto">Upload Left Hand</button>
                </div>
                <div class="flex-1 p-4 border-2 border-gray-200 rounded-lg flex flex-col">
                    <h3 class="font-display text-lg mb-2">Right Hand</h3>
                    <p class="text-sm text-gray-500 mb-4">Your current path & achievements</p>
                    <div class="relative mb-2 flex-grow">
                        <img id="rightHandPreview" src="#" alt="Right Palm Preview" class="hidden w-full h-48 object-contain rounded-lg border border-gray-200"/>
                        <button id="removeRightImageButton" class="absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full shadow-lg hidden hover:bg-red-600 transition-colors" aria-label="Remove right hand image">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <input type="file" id="rightHandInput" accept="image/*" class="hidden">
                    <button onclick="document.getElementById('rightHandInput').click()" class="button button-secondary w-full mt-auto">Upload Right Hand</button>
                </div>
            </div>

            <button id="startAnalysisButton" class="button" disabled>Begin Complete Palm Reading</button>
            <p id="uploadStatus" class="text-sm text-gray-500 mt-2">Please upload both hands for a complete reading.</p>
            <button id="backToWelcomeButton" class="button button-secondary mt-4">Back</button>
        </div>
        
        <div id="analyzingScreen" class="card hidden">
            <h2 class="text-2xl font-display font-semibold text-gray-700 mb-4">Analyzing Your Palm...</h2>
            <p class="text-gray-600 mb-4">Glimpsing into the patterns of your unique hand. Please wait a moment.</p>
            <div class="scan-container mx-auto mb-4" style="max-width: 200px; max-height:200px;">
                <img id="analyzingPalmImageDisplay" src="#" alt="Analyzing Palm"/>
                <div class="scan-line"></div>
            </div>
            <div class="loader"></div>
        </div>


        <div id="mainContentScreen" class="card hidden">
            <div class="flex flex-wrap justify-center mb-6 border-b pb-3">
                <button id="tabPalmLines" class="tab-button active">Palm Lines</button>
                <button id="tabElement" class="tab-button">Your Element</button>
                <button id="tabAstro" class="tab-button">Astro-Link</button>
            </div>
            <img id="readingPalmImage" src="#" alt="Your Palm" class="hidden mb-4"/>

            <div id="palmLinesContent">
                <h3 class="text-xl font-display font-semibold text-gray-700 mb-1">Insights from Your Palm Lines</h3>
                <p class="text-sm text-gray-500 mb-4">Our mystical scan has revealed characteristics of your major lines.</p>
                <button id="revealPalmLineInsightsButton" class="button">Reveal Palm Line Insights</button>
                <div id="palmLineReadingResult" class="reading-text mt-4 hidden"></div>
            </div>

            <div id="elementTypeContent" class="hidden">
                <h3 class="text-xl font-display font-semibold text-gray-700 mb-2">Your Revealed Elemental Hand</h3>
                <p class="text-sm text-gray-500 mb-4">The energies of your hand shape have been identified by our scan.</p>
                <button id="revealElementalHandInsightsButton" class="button">Reveal Elemental Hand Insights</button>
                <div id="elementReadingResult" class="reading-text mt-4 hidden"></div>
            </div>

            <div id="astroPalmistryContent" class="hidden">
                <h3 class="text-xl font-display font-semibold text-gray-700 mb-2">Astrology & Palmistry Connection</h3>
                <p class="text-sm text-gray-500 mb-4">Explore how your identified elemental hand type may intertwine with your astrological sign.</p>
                <div class="mb-4">
                    <label for="astrologicalSignSelect">Select Your Astrological Sign:</label>
                    <select id="astrologicalSignSelect">
                        <option value="">-- Select Sign --</option>
                        <option value="aries">Aries (Fire)</option>
                        <option value="taurus">Taurus (Earth)</option>
                        <option value="gemini">Gemini (Air)</option>
                        <option value="cancer">Cancer (Water)</option>
                        <option value="leo">Leo (Fire)</option>
                        <option value="virgo">Virgo (Earth)</option>
                        <option value="libra">Libra (Air)</option>
                        <option value="scorpio">Scorpio (Water)</option>
                        <option value="sagittarius">Sagittarius (Fire)</option>
                        <option value="capricorn">Capricorn (Earth)</option>
                        <option value="aquarius">Aquarius (Air)</option>
                        <option value="pisces">Pisces (Water)</option>
                    </select>
                </div>
                <button id="getAstroReadingButton" class="button">Get Astro-Palmistry Insights</button>
                <div id="astroReadingResult" class="reading-text mt-4 hidden"></div>
            </div>
             <button id="scanAgainButton" class="button button-secondary mt-6">Start New Reading</button>
        </div>

    </div>

    <footer class="w-full max-w-2xl mx-auto px-4 py-8 text-center">
        <div class="mb-4">
            <a href="https://twitter.com/crocboot" target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-primary hover:text-primary-dark transition-colors">
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path>
                </svg>
                <span class="font-medium">Follow @crocboot</span>
            </a>
        </div>
        <p class="text-sm text-gray-500 max-w-prose mx-auto leading-relaxed">
            Palmistry is widely considered a form of cultural, historical, and entertainment-based interpretation rather than a scientifically validated predictive method. The readings provided by PalmReading – Palm Reading are meant for personal reflection and enjoyment, not as professional guidance, medical advice, or factual predictions.
        </p>
    </footer>

    <script>
        // Wrap everything in DOMContentLoaded to ensure elements exist
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const welcomeScreen = document.getElementById('welcomeScreen');
            const uploadScreen = document.getElementById('uploadScreen');
            const analyzingScreen = document.getElementById('analyzingScreen');
            const mainContentScreen = document.getElementById('mainContentScreen');

            const startScanButton = document.getElementById('startScanButton');
            const backToWelcomeButton = document.getElementById('backToWelcomeButton');
            const startAnalysisButton = document.getElementById('startAnalysisButton');
            
            const analyzingPalmImageDisplay = document.getElementById('analyzingPalmImageDisplay');
            const readingPalmImage = document.getElementById('readingPalmImage');

            const tabPalmLines = document.getElementById('tabPalmLines');
            const tabElement = document.getElementById('tabElement');
            const tabAstro = document.getElementById('tabAstro');

            const palmLinesContent = document.getElementById('palmLinesContent');
            const elementTypeContent = document.getElementById('elementTypeContent');
            const astroPalmistryContent = document.getElementById('astroPalmistryContent');

            const revealPalmLineInsightsButton = document.getElementById('revealPalmLineInsightsButton');
            const palmLineReadingResult = document.getElementById('palmLineReadingResult');
            const revealElementalHandInsightsButton = document.getElementById('revealElementalHandInsightsButton');
            const elementReadingResult = document.getElementById('elementReadingResult');

            const astrologicalSignSelect = document.getElementById('astrologicalSignSelect');
            const getAstroReadingButton = document.getElementById('getAstroReadingButton');
            const astroReadingResult = document.getElementById('astroReadingResult');
            
            const scanAgainButton = document.getElementById('scanAgainButton');

            // File upload elements
            const leftHandInput = document.getElementById('leftHandInput');
            const rightHandInput = document.getElementById('rightHandInput');
            const leftHandPreview = document.getElementById('leftHandPreview');
            const rightHandPreview = document.getElementById('rightHandPreview');
            const removeLeftImageButton = document.getElementById('removeLeftImageButton');
            const removeRightImageButton = document.getElementById('removeRightImageButton');
            const uploadStatus = document.getElementById('uploadStatus');

            // App State
            const userSelections = {
                palmLines: {
                    left: {},
                    right: {}
                },
                elementHand: {
                    left: null,
                    right: null
                },
                astrologicalSign: null
            };

            // Track uploaded images
            const uploadedImages = {
                left: null,
                right: null
            };

            // Palm Reading Data
            const palmData = {
                handMeanings: {
                    left: "Your left hand reveals your innate potential, genetic predispositions, and inherited traits. It shows the raw material you were given at birth - your natural talents, inherent challenges, and the karmic lessons carried from past lives. This hand tells the story of what was written in your stars.",
                    right: "Your right hand represents your current journey, personal growth, and conscious choices. It shows how you've shaped your destiny, overcome challenges, and developed your abilities. This hand reveals the story you're actively writing in this lifetime."
                },
                palmLineDefinitions: [
                    {
                        id: 'lifeLine',
                        name: "Life Line",
                        description: "The life line reveals vitality, life force, and major life changes",
                        options: [
                            { value: 'deep', text: "Deep and clearly marked" },
                            { value: 'chained', text: "Chain-like or broken" },
                            { value: 'straight', text: "Straight and close to thumb" },
                            { value: 'curved', text: "Widely curved" },
                            { value: 'islanded', text: "Contains islands or splits" },
                            { value: 'double', text: "Double life line" },
                            { value: 'long', text: "Long and sweeping" }
                        ]
                    },
                    {
                        id: 'headLine',
                        name: "Head Line",
                        description: "The head line shows intellectual capacity, communication style, and mental approach",
                        options: [
                            { value: 'long', text: "Long and straight" },
                            { value: 'curved', text: "Curved downward" },
                            { value: 'separated', text: "Separated from life line" },
                            { value: 'wavy', text: "Wavy or forked" },
                            { value: 'short', text: "Short and straight" },
                            { value: 'deep', text: "Deep and clear" },
                            { value: 'chained', text: "Chain-like formation" }
                        ]
                    },
                    {
                        id: 'heartLine',
                        name: "Heart Line",
                        description: "The heart line indicates emotional capacity, relationships, and love life",
                        options: [
                            { value: 'curved', text: "Curved upward" },
                            { value: 'straight', text: "Straight across" },
                            { value: 'forked', text: "Forked at end" },
                            { value: 'chained', text: "Chain-like formation" },
                            { value: 'deep', text: "Deep and clear" },
                            { value: 'long', text: "Long and sweeping" },
                            { value: 'short', text: "Short and defined" }
                        ]
                    },
                    {
                        id: 'fateLine',
                        name: "Fate Line",
                        description: "The fate line shows career path, life direction, and major life events",
                        options: [
                            { value: 'deep', text: "Deep and unbroken" },
                            { value: 'broken', text: "Broken or fragmented" },
                            { value: 'starting', text: "Starts from life line" },
                            { value: 'missing', text: "Faint or absent" },
                            { value: 'branched', text: "Multiple branches" },
                            { value: 'chained', text: "Chain-like pattern" },
                            { value: 'island', text: "Contains islands" }
                        ]
                    },
                    {
                        id: 'sunLine',
                        name: "Sun Line",
                        description: "The sun line indicates fame, success, and creative expression",
                        options: [
                            { value: 'present', text: "Clear and present" },
                            { value: 'absent', text: "Absent or very faint" },
                            { value: 'multiple', text: "Multiple lines" },
                            { value: 'broken', text: "Broken or fragmented" },
                            { value: 'deep', text: "Deep and prominent" },
                            { value: 'branched', text: "Branching upward" }
                        ]
                    }
                ],
                palmLineReadings: {
                    lifeLine: {
                        left: {
                            deep: "Your inherited vitality is remarkably strong. You come from a lineage of resilient individuals, and this deep life line suggests you were born with natural endurance and a robust constitution. Your ancestors have passed down a powerful life force that serves as a foundation for longevity and resilience.",
                            chained: "Your inherited energy patterns show some natural fluctuations. This suggests that adaptability runs in your family, and you've inherited the ability to navigate life's changing rhythms. Your ancestors' experiences have taught you the value of resilience through challenges.",
                            straight: "You've inherited a naturally conservative approach to energy management. Your lineage values efficiency and practicality, suggesting you were born with an innate ability to maintain steady progress and preserve your resources wisely.",
                            curved: "Your inherited spirit is naturally adventurous. Your ancestry carries a legacy of exploration and adaptability, suggesting you were born with an innate desire to experience life fully and embrace new horizons.",
                            islanded: "Your inherited life path contains natural periods of transformation. These genetic patterns suggest you were born with an innate ability to evolve and adapt, carrying your ancestors' wisdom of navigating life's transitions.",
                            double: "You possess an extraordinary inherited vitality. This rare pattern suggests you were born with a backup system of energy and protection, indicating strong ancestral support and natural resilience.",
                            long: "Your inherited life force is expansive and far-reaching. This pattern suggests you come from a lineage of long-lived individuals, carrying their potential for endurance and sustained vitality."
                        },
                        right: {
                            deep: "You've developed remarkable physical and emotional stamina through your life choices. Your current path shows strong vitality and a well-maintained energy system, indicating you've learned to channel your life force effectively.",
                            chained: "Your current energy management shows conscious adaptation to life's rhythms. You've learned to pace yourself and handle various energy levels, developing resilience through experience.",
                            straight: "You've cultivated a practical approach to managing your vitality. Your current path reflects careful energy conservation and efficient use of resources, showing wisdom in maintaining life balance.",
                            curved: "You've actively expanded your life's boundaries and embraced diverse experiences. Your current path shows a dynamic approach to living, with energy flowing freely into various aspects of life.",
                            islanded: "Your life path shows conscious periods of transformation and renewal. You've learned to use challenging times as opportunities for growth and regeneration.",
                            double: "You've developed an exceptional secondary support system in life. This indicates you've built strong protective networks and backup resources for your journey.",
                            long: "You've cultivated extensive vitality through conscious lifestyle choices. Your current path shows commitment to longevity and sustainable energy management."
                        }
                    },
                    headLine: {
                        left: {
                            long: "You were born with a natural capacity for deep analytical thinking. Your inherited mental abilities favor detailed analysis and comprehensive understanding, suggesting strong intellectual genes in your family line.",
                            curved: "Your inherited creative intelligence is significant. This pattern suggests natural artistic abilities and intuitive understanding passed down through your family line.",
                            separated: "Independence of thought is your birthright. This separation indicates inherited mental autonomy and natural innovative thinking abilities.",
                            wavy: "You inherited a versatile and adaptable mind. Your mental flexibility comes from a lineage of creative problem-solvers and multi-faceted thinkers.",
                            short: "Your inherited thinking style favors quick, instinctive decisions. This suggests a family history of practical intelligence and efficient mental processing.",
                            deep: "You possess naturally strong mental clarity and focus. This depth indicates inherited intellectual strength and mental resilience.",
                            chained: "Your inherited mental patterns show natural periods of intense analysis followed by intuitive understanding. This suggests a family history of complex problem-solving abilities."
                        },
                        right: {
                            long: "You've developed sophisticated analytical abilities through education and experience. Your current mental approach shows disciplined thinking and detailed analysis.",
                            curved: "You've cultivated strong creative thinking skills. Your current mental approach balances logic with imagination, showing developed artistic and innovative abilities.",
                            separated: "You've established strong mental independence. Your current thinking patterns show self-reliance and original thought processes.",
                            wavy: "You've developed versatile thinking strategies. Your current mental approach shows adaptability and the ability to handle multiple perspectives.",
                            short: "You've refined your ability to make quick, effective decisions. Your current mental approach favors practical solutions and efficient processing.",
                            deep: "You've cultivated strong mental focus and clarity. Your current thinking patterns show developed concentration and analytical abilities.",
                            chained: "You've developed a rhythmic approach to mental work. Your current thinking patterns show balanced periods of analysis and intuition."
                        }
                    },
                    heartLine: {
                        left: {
                            curved: "You were born with natural emotional warmth and expressiveness. Your inherited emotional nature is generous and idealistic, suggesting a family legacy of open-hearted connections.",
                            straight: "Your inherited emotional nature is naturally steady and reliable. This suggests a family history of stable, committed relationships and emotional consistency.",
                            forked: "You inherited a naturally nuanced emotional understanding. This pattern suggests an innate ability to balance different types of relationships and emotional experiences.",
                            chained: "Your inherited emotional sensitivity is complex and deep. This pattern suggests a family history of rich emotional experiences and intuitive understanding.",
                            deep: "You possess naturally strong emotional awareness and stability. This suggests inherited emotional intelligence and depth of feeling.",
                            long: "Your inherited emotional capacity is expansive and generous. This suggests a family legacy of deep emotional connections and lasting relationships.",
                            short: "You inherited a focused and selective emotional nature. This suggests a family history of meaningful, carefully chosen relationships."
                        },
                        right: {
                            curved: "You've developed a warm and expressive emotional style. Your current approach to relationships shows generosity and romantic idealism.",
                            straight: "You've cultivated emotional stability and reliability. Your current relationship approach values consistency and commitment.",
                            forked: "You've developed sophisticated emotional understanding. Your current relationship style shows ability to balance various emotional needs.",
                            chained: "You've developed complex emotional awareness. Your current emotional life shows depth and sensitivity in relationships.",
                            deep: "You've cultivated strong emotional intelligence. Your current relationship approach shows maturity and emotional wisdom.",
                            long: "You've developed expansive emotional connections. Your current relationship style shows generosity and deep involvement.",
                            short: "You've cultivated focused and meaningful relationships. Your current emotional approach values quality over quantity."
                        }
                    },
                    fateLine: {
                        left: {
                            deep: "Your inherited sense of purpose is strong and clear. This suggests a family legacy of determined goal-pursuit and clear life direction.",
                            broken: "Your inherited path shows natural flexibility. This pattern suggests a family history of successful adaptation to changing circumstances.",
                            starting: "Your inherited purpose is closely tied to personal identity. This suggests a family legacy of self-determined success.",
                            missing: "Your inherited path favors flexibility and free will. This suggests a family history of creating success through unconventional means.",
                            branched: "You inherited multiple talents and potential paths. This suggests a family legacy of diverse achievements and opportunities.",
                            chained: "Your inherited path shows natural phases of development. This suggests a family history of gradual, steady progress.",
                            island: "Your inherited path contains periods of special focus. This suggests a family history of overcoming challenges through concentration."
                        },
                        right: {
                            deep: "You've developed a strong sense of purpose and direction. Your current path shows clear goals and determined progress.",
                            broken: "You've learned to adapt and thrive through changes. Your current path shows resilience and flexibility in achieving goals.",
                            starting: "You've created your own path to success. Your current direction shows strong personal initiative and self-determination.",
                            missing: "You've developed unconventional routes to success. Your current path shows creative approaches to achievement.",
                            branched: "You've developed multiple successful directions. Your current path shows diverse achievements and opportunities.",
                            chained: "You've developed a steady approach to progress. Your current path shows consistent development and growth.",
                            island: "You've learned to focus intensely on specific goals. Your current path shows successful navigation of challenges."
                        }
                    },
                    sunLine: {
                        left: {
                            present: "You inherited natural charisma and potential for recognition. This suggests a family legacy of achievement and public success.",
                            absent: "Your inherited path favors behind-the-scenes influence. This suggests a family history of meaningful private achievements.",
                            multiple: "You inherited diverse talents for recognition. This suggests a family legacy of varied accomplishments and public appreciation.",
                            broken: "Your inherited path shows phases of public recognition. This suggests a family history of periodic achievements and acknowledgment.",
                            deep: "You inherited strong potential for public success. This suggests a family legacy of significant achievements and recognition.",
                            branched: "You inherited multiple paths to recognition. This suggests a family legacy of diverse talents and public appreciation."
                        },
                        right: {
                            present: "You've developed strong presence and earned recognition. Your current path shows achievement and public acknowledgment.",
                            absent: "You've cultivated meaningful influence through private channels. Your current achievements focus on personal fulfillment.",
                            multiple: "You've developed various paths to recognition. Your current achievements show diversity and broad appreciation.",
                            broken: "You've experienced different phases of recognition. Your current path shows periodic achievements and acknowledgment.",
                            deep: "You've cultivated significant public success. Your current path shows strong achievement and recognition.",
                            branched: "You've developed multiple channels for recognition. Your current path shows diverse talents and public appreciation."
                        }
                    }
                },
                elementHandDefinitions: [
                    {
                        id: 'elementHand',
                        name: "Elemental Hand",
                        options: [
                            { value: 'earth', text: "Earth Hand" },
                            { value: 'fire', text: "Fire Hand" },
                            { value: 'water', text: "Water Hand" },
                            { value: 'air', text: "Air Hand" }
                        ]
                    }
                ],
                elementReadings: {
                    earth: "<strong>Earth Hand Traits:</strong> You are likely practical, reliable, and grounded. You value stability and tangible results, often possessing a strong connection to nature and a down-to-earth approach to life. You build things to last but can sometimes be resistant to change.",
                    fire: "<strong>Fire Hand Traits:</strong> You are likely passionate, ambitious, energetic, and enthusiastic. You are a natural leader, often inspiring others, but can also be impulsive or restless. You thrive on action and new challenges.",
                    water: "<strong>Water Hand Traits:</strong> You are likely intuitive, creative, empathetic, and emotionally sensitive. You navigate the world through your feelings and imagination, often possessing artistic talents and a deep understanding of others. You seek connection and can be adaptable.",
                    air: "<strong>Air Hand Traits:</strong> You are likely intellectual, communicative, analytical, and curious. You thrive on ideas, social interaction, and mental stimulation. You are often witty and logical, but can sometimes be prone to overthinking or anxiety."
                },
                astroSignInteractions: {
                    earth: {
                        earth: "An Earth hand with an Earth astrological sign (Taurus, Virgo, Capricorn) creates a profoundly grounded and stable individual. Your practicality is doubled, making you exceptionally reliable, patient, and connected to the material world. You build with enduring strength.",
                        air: "An Earth hand with an Air astrological sign (Gemini, Libra, Aquarius) blends practicality with intellect. You can bring abstract ideas into tangible form. Your communication is thoughtful, and you seek logical solutions to real-world problems.",
                        fire: "An Earth hand with a Fire astrological sign (Aries, Leo, Sagittarius) combines steadfastness with dynamism. You have the energy to pursue practical goals with passion and the determination to see ambitious projects through.",
                        water: "An Earth hand with a Water astrological sign (Cancer, Scorpio, Pisces) suggests a nurturing and deeply intuitive practicality. You ground your emotions in tangible actions and care, creating a secure and supportive environment."
                    },
                    fire: {
                        earth: "A Fire hand with an Earth astrological sign (Taurus, Virgo, Capricorn) channels passionate energy into practical achievements. You have the drive to make tangible progress and the stamina to pursue ambitious, real-world goals.",
                        air: "A Fire hand with an Air astrological sign (Gemini, Libra, Aquarius) creates a dynamic communicator and innovator. Your enthusiasm fuels intellectual pursuits, and you can inspire others with your bold ideas and quick wit.",
                        fire: "A Fire hand with a Fire astrological sign (Aries, Leo, Sagittarius) results in an intensely passionate and energetic individual. You are a force of nature, driven by enthusiasm, courage, and a desire to lead and explore.",
                        water: "A Fire hand with a Water astrological sign (Cancer, Scorpio, Pisces) blends passionate action with deep emotional intuition. You can pursue your goals with fervor while being highly attuned to the emotional undercurrents around you."
                    },
                    water: {
                        earth: "A Water hand with an Earth astrological sign (Taurus, Virgo, Capricorn) suggests that your intuitive and emotional nature finds expression in practical, caring ways. You offer stable support and create beauty in the tangible world.",
                        air: "A Water hand with an Air astrological sign (Gemini, Libra, Aquarius) combines emotional depth with intellectual curiosity. You can articulate complex feelings and ideas, fostering understanding and connection through communication.",
                        fire: "A Water hand with a Fire astrological sign (Aries, Leo, Sagittarius) creates a dynamic individual whose emotions fuel their passions. You are likely charismatic and inspiring, channeling your sensitivity into enthusiastic action.",
                        water: "A Water hand with a Water astrological sign (Cancer, Scorpio, Pisces) results in profound emotional depth, intuition, and empathy. You are highly attuned to the unseen world and navigate life through your feelings and creative expression."
                    },
                    air: {
                        earth: "An Air hand with an Earth astrological sign (Taurus, Virgo, Capricorn) grounds intellectual pursuits in practical application. You are a thoughtful planner, capable of developing logical systems and achieving tangible results through careful analysis.",
                        air: "An Air hand with an Air astrological sign (Gemini, Libra, Aquarius) creates a highly intellectual, communicative, and social individual. You thrive on ideas, information exchange, and connecting with diverse groups of people.",
                        fire: "An Air hand with a Fire astrological sign (Aries, Leo, Sagittarius) blends intellectual agility with passionate enthusiasm. You can articulate bold visions and inspire action through your dynamic ideas and persuasive communication.",
                        water: "An Air hand with a Water astrological sign (Cancer, Scorpio, Pisces) suggests an ability to intellectually understand and communicate deep emotional insights. You may be a gifted counselor or writer, bridging logic and intuition."
                    }
                },
                astrologicalSignToElement: {
                    aries: 'fire', taurus: 'earth', gemini: 'air', cancer: 'water',
                    leo: 'fire', virgo: 'earth', libra: 'air', scorpio: 'water',
                    sagittarius: 'fire', capricorn: 'earth', aquarius: 'air', pisces: 'water'
                }
            };

            // Hand detection setup
            let hands;
            let handDetectionReady = false;
            
            // Initialize MediaPipe Hands
            async function initializeHandDetection() {
                try {
                    const { Hands } = window;
                    hands = new Hands({
                        locateFile: (file) => {
                            return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
                        }
                    });
                    
                    hands.setOptions({
                        maxNumHands: 2,
                        modelComplexity: 1,
                        minDetectionConfidence: 0.5,
                        minTrackingConfidence: 0.5
                    });
                    
                    handDetectionReady = true;
                    console.log('Hand detection initialized');
                } catch (error) {
                    console.warn('Hand detection unavailable, using basic validation:', error);
                    handDetectionReady = false;
                }
            }
            
            // Validate if image contains a hand
            async function validateHandImage(imageElement) {
                return new Promise((resolve) => {
                    if (!handDetectionReady) {
                        // Fallback validation - basic image checks
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        canvas.width = imageElement.naturalWidth;
                        canvas.height = imageElement.naturalHeight;
                        ctx.drawImage(imageElement, 0, 0);
                        
                        // Basic heuristics - check if image is reasonable size and aspect ratio
                        const aspectRatio = canvas.width / canvas.height;
                        const isReasonableSize = canvas.width > 200 && canvas.height > 200;
                        const isReasonableAspectRatio = aspectRatio > 0.5 && aspectRatio < 2;
                        
                        resolve(isReasonableSize && isReasonableAspectRatio);
                        return;
                    }
                    
                    try {
                        let handDetected = false;
                        
                        hands.onResults((results) => {
                            handDetected = results.multiHandLandmarks && results.multiHandLandmarks.length > 0;
                            resolve(handDetected);
                        });
                        
                        // Send image to MediaPipe
                        hands.send({ image: imageElement });
                        
                        // Timeout after 5 seconds
                        setTimeout(() => {
                            if (!handDetected) {
                                resolve(false);
                            }
                        }, 5000);
                        
                    } catch (error) {
                        console.error('Hand detection error:', error);
                        resolve(false);
                    }
                });
            }
            
            // Show error message
            function showErrorMessage(message, hand) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 max-w-md text-center';
                errorDiv.innerHTML = `
                    <div class="flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span>${message}</span>
                    </div>
                `;
                
                document.body.appendChild(errorDiv);
                
                // Remove error message after 4 seconds
                setTimeout(() => {
                    if (errorDiv.parentNode) {
                        errorDiv.parentNode.removeChild(errorDiv);
                    }
                }, 4000);
            }
            
            // Initialize hand detection
            initializeHandDetection();

            // Navigation Functions
            function showScreen(screenElement) {
                console.log('Showing screen:', screenElement?.id);
                if (!screenElement) {
                    console.error('Screen element is null');
                    return;
                }
                [welcomeScreen, uploadScreen, analyzingScreen, mainContentScreen].forEach(s => {
                    if (s) {
                        s.classList.add('hidden');
                        console.log('Hiding screen:', s.id);
                    }
                });
                screenElement.classList.remove('hidden');
                console.log('Removed hidden class from:', screenElement.id);
            }

            function setActiveTab(activeTabButton, activeContentElement) {
                if (!activeTabButton || !activeContentElement) return;
                [tabPalmLines, tabElement, tabAstro].forEach(btn => {
                    if (btn) btn.classList.remove('active');
                });
                activeTabButton.classList.add('active');

                [palmLinesContent, elementTypeContent, astroPalmistryContent].forEach(content => {
                    if (content) content.classList.add('hidden');
                });
                activeContentElement.classList.remove('hidden');
            }

            // Add these functions before the event listeners
            function resetAppState() {
                console.log('Resetting app state');
                // Reset uploaded images
                uploadedImages.left = null;
                uploadedImages.right = null;
                
                // Reset preview images
                if (leftHandPreview) {
                    leftHandPreview.src = '#';
                    leftHandPreview.classList.add('hidden');
                }
                if (rightHandPreview) {
                    rightHandPreview.src = '#';
                    rightHandPreview.classList.add('hidden');
                }
                
                // Reset file inputs
                if (leftHandInput) leftHandInput.value = '';
                if (rightHandInput) rightHandInput.value = '';
                
                // Hide remove buttons
                if (removeLeftImageButton) removeLeftImageButton.classList.add('hidden');
                if (removeRightImageButton) removeRightImageButton.classList.add('hidden');
                
                // Reset analysis button
                if (startAnalysisButton) {
                    startAnalysisButton.disabled = true;
                    startAnalysisButton.classList.add('opacity-50', 'cursor-not-allowed');
                }
                
                // Reset upload status
                if (uploadStatus) {
                    uploadStatus.textContent = "Please upload both hands for a complete reading.";
                    uploadStatus.className = "text-sm text-gray-500 mt-2";
                }
            }

            function simulatePalmLineAnalysis(hand) {
                console.log(`Simulating palm line analysis for ${hand} hand`);
                palmData.palmLineDefinitions.forEach(line => {
                    const options = line.options;
                    const randomOption = options[Math.floor(Math.random() * options.length)];
                    userSelections.palmLines[hand][line.id] = randomOption.value;
                });
            }

            function simulateElementalHandAnalysis(hand) {
                console.log(`Simulating elemental hand analysis for ${hand} hand`);
                const elementOptions = palmData.elementHandDefinitions[0].options;
                const randomElement = elementOptions[Math.floor(Math.random() * elementOptions.length)];
                userSelections.elementHand[hand] = randomElement.value;
            }

            // Event Listeners
            if (startScanButton) {
                startScanButton.addEventListener('click', () => {
                    console.log('Start scan clicked');
                    if (uploadScreen) {
                        showScreen(uploadScreen);
                    } else {
                        console.error('Upload screen not found');
                    }
                });
            } else {
                console.error('Start scan button not found');
            }

            if (backToWelcomeButton) {
                backToWelcomeButton.addEventListener('click', () => {
                    console.log('Back to welcome clicked');
                    resetAppState();
                    showScreen(welcomeScreen);
                });
            }

            if (startAnalysisButton) {
                startAnalysisButton.addEventListener('click', () => {
                    console.log('Start analysis clicked');
                    if (!uploadedImages.left || !uploadedImages.right) {
                        alert("Please upload both hands before starting the analysis.");
                        return;
                    }
                    
                    if (analyzingPalmImageDisplay) {
                        analyzingPalmImageDisplay.src = uploadedImages.left;
                    }
                    if (readingPalmImage) {
                        readingPalmImage.src = uploadedImages.left;
                    }
                    showScreen(analyzingScreen);

                    setTimeout(() => {
                        simulatePalmLineAnalysis('left');
                        simulateElementalHandAnalysis('left');
                        
                        if (analyzingPalmImageDisplay) {
                            analyzingPalmImageDisplay.src = uploadedImages.right;
                        }
                        setTimeout(() => {
                            simulatePalmLineAnalysis('right');
                            simulateElementalHandAnalysis('right');
                            
                            if (readingPalmImage) {
                                readingPalmImage.classList.remove('hidden');
                            }
                            setActiveTab(tabPalmLines, palmLinesContent);
                            showScreen(mainContentScreen);
                        }, 2000);
                    }, 2000);
                });
            }

            // File Upload Handlers
            function handleFileUpload(event, hand) {
                console.log(`Handling file upload for ${hand} hand`);
                const file = event.target.files[0];
                const preview = hand === 'left' ? leftHandPreview : rightHandPreview;
                const removeButton = hand === 'left' ? removeLeftImageButton : removeRightImageButton;
                const input = event.target;

                if (file) {
                    // Validate file type
                    if (!file.type.startsWith('image/')) {
                        showErrorMessage('Please upload an image file', hand);
                        input.value = '';
                        return;
                    }
                    
                    // Validate file size (max 10MB)
                    if (file.size > 10 * 1024 * 1024) {
                        showErrorMessage('Image file is too large. Please upload an image smaller than 10MB', hand);
                        input.value = '';
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = async function(e) {
                        // Create temporary image element for validation
                        const tempImg = new Image();
                        tempImg.onload = async function() {
                            try {
                                // Show loading message
                                const loadingDiv = document.createElement('div');
                                loadingDiv.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-blue-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 max-w-md text-center';
                                loadingDiv.innerHTML = `
                                    <div class="flex items-center">
                                        <svg class="animate-spin w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24">
                                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
                                        </svg>
                                        <span>Validating ${hand} hand image...</span>
                                    </div>
                                `;
                                document.body.appendChild(loadingDiv);
                                
                                // Validate hand detection
                                const isValidHand = await validateHandImage(tempImg);
                                
                                // Remove loading message
                                if (loadingDiv.parentNode) {
                                    loadingDiv.parentNode.removeChild(loadingDiv);
                                }
                                
                                if (!isValidHand) {
                                    showErrorMessage(`No hand detected in ${hand} hand image. Please upload a clear photo of your ${hand} hand palm.`, hand);
                                    input.value = '';
                                    return;
                                }
                                
                                // If validation passes, update the preview
                                if (preview) {
                                    preview.src = e.target.result;
                                    preview.classList.remove('hidden');
                                }
                                if (removeButton) {
                                    removeButton.classList.remove('hidden');
                                }
                                uploadedImages[hand] = e.target.result;
                                updateUploadStatus();
                                
                                // Show success message
                                const successDiv = document.createElement('div');
                                successDiv.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 max-w-md text-center';
                                successDiv.innerHTML = `
                                    <div class="flex items-center">
                                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                        </svg>
                                        <span>${hand.charAt(0).toUpperCase() + hand.slice(1)} hand validated successfully!</span>
                                    </div>
                                `;
                                document.body.appendChild(successDiv);
                                
                                setTimeout(() => {
                                    if (successDiv.parentNode) {
                                        successDiv.parentNode.removeChild(successDiv);
                                    }
                                }, 3000);
                                
                            } catch (error) {
                                console.error('Validation error:', error);
                                showErrorMessage('Error validating image. Please try again.', hand);
                                input.value = '';
                            }
                        };
                        
                        tempImg.onerror = function() {
                            showErrorMessage('Invalid image file. Please upload a valid image.', hand);
                            input.value = '';
                        };
                        
                        tempImg.src = e.target.result;
                    };
                    
                    reader.onerror = function() {
                        showErrorMessage('Error reading image file. Please try again.', hand);
                        input.value = '';
                    };
                    
                    reader.readAsDataURL(file);
                }
            }

            function removeImage(hand) {
                const input = hand === 'left' ? leftHandInput : rightHandInput;
                const preview = hand === 'left' ? leftHandPreview : rightHandPreview;
                const removeButton = hand === 'left' ? removeLeftImageButton : removeRightImageButton;

                if (input) input.value = '';
                if (preview) {
                    preview.src = '#';
                    preview.classList.add('hidden');
                }
                if (removeButton) removeButton.classList.add('hidden');
                uploadedImages[hand] = null;
                updateUploadStatus();
            }

            function updateUploadStatus() {
                const bothUploaded = uploadedImages.left && uploadedImages.right;
                if (startAnalysisButton) {
                    startAnalysisButton.disabled = !bothUploaded;
                    if (bothUploaded) {
                        startAnalysisButton.classList.remove('opacity-50', 'cursor-not-allowed');
                    } else {
                        startAnalysisButton.classList.add('opacity-50', 'cursor-not-allowed');
                    }
                }
                
                if (uploadStatus) {
                    if (bothUploaded) {
                        uploadStatus.textContent = "Both hands uploaded - ready for reading!";
                        uploadStatus.className = "text-sm text-green-600 mt-2";
                    } else if (!uploadedImages.left && !uploadedImages.right) {
                        uploadStatus.textContent = "Please upload both hands for a complete reading.";
                        uploadStatus.className = "text-sm text-gray-500 mt-2";
                    } else {
                        const missing = !uploadedImages.left ? "left" : "right";
                        uploadStatus.textContent = `Please upload your ${missing} hand to complete the reading.`;
                        uploadStatus.className = "text-sm text-yellow-600 mt-2";
                    }
                }
            }

            // Attach file upload event listeners
            if (leftHandInput) {
                leftHandInput.addEventListener('change', (e) => {
                    console.log('Left hand file selected');
                    handleFileUpload(e, 'left');
                });
            } else {
                console.error('Left hand input not found');
            }

            if (rightHandInput) {
                rightHandInput.addEventListener('change', (e) => {
                    console.log('Right hand file selected');
                    handleFileUpload(e, 'right');
                });
            } else {
                console.error('Right hand input not found');
            }

            if (removeLeftImageButton) {
                removeLeftImageButton.addEventListener('click', () => removeImage('left'));
            }
            if (removeRightImageButton) {
                removeRightImageButton.addEventListener('click', () => removeImage('right'));
            }

            // Initial setup
            console.log('Initializing app...');
            if (welcomeScreen) {
                console.log('Showing welcome screen');
                showScreen(welcomeScreen);
            } else {
                console.error('Welcome screen not found');
            }

            // Event listeners for the reading buttons
            if (revealPalmLineInsightsButton) {
                revealPalmLineInsightsButton.addEventListener('click', () => {
                    console.log('Revealing palm line insights');
                    let readingHtml = '';
                    
                    // Add left hand readings
                    readingHtml += '<h4 class="text-lg font-semibold mb-2">Left Hand - Inherited Traits</h4>';
                    readingHtml += '<p class="mb-4">' + palmData.handMeanings.left + '</p>';
                    
                    palmData.palmLineDefinitions.forEach(line => {
                        const leftValue = userSelections.palmLines.left[line.id];
                        if (leftValue && palmData.palmLineReadings[line.id][leftValue]) {
                            readingHtml += `<p><strong>${line.name}:</strong> ${palmData.palmLineReadings[line.id][leftValue]}</p>`;
                        }
                    });
                    
                    // Add right hand readings
                    readingHtml += '<h4 class="text-lg font-semibold mt-6 mb-2">Right Hand - Current Path</h4>';
                    readingHtml += '<p class="mb-4">' + palmData.handMeanings.right + '</p>';
                    
                    palmData.palmLineDefinitions.forEach(line => {
                        const rightValue = userSelections.palmLines.right[line.id];
                        if (rightValue && palmData.palmLineReadings[line.id][rightValue]) {
                            readingHtml += `<p><strong>${line.name}:</strong> ${palmData.palmLineReadings[line.id][rightValue]}</p>`;
                        }
                    });
                    
                    if (palmLineReadingResult) {
                        palmLineReadingResult.innerHTML = readingHtml;
                        palmLineReadingResult.classList.remove('hidden');
                        revealPalmLineInsightsButton.classList.add('hidden');
                    }
                });
            }

            if (revealElementalHandInsightsButton) {
                revealElementalHandInsightsButton.addEventListener('click', () => {
                    console.log('Revealing elemental hand insights');
                    let readingHtml = '';
                    
                    // Add left hand element reading
                    const leftElement = userSelections.elementHand.left;
                    if (leftElement && palmData.elementReadings[leftElement]) {
                        readingHtml += '<h4 class="text-lg font-semibold mb-2">Left Hand Element</h4>';
                        readingHtml += palmData.elementReadings[leftElement];
                    }
                    
                    // Add right hand element reading
                    const rightElement = userSelections.elementHand.right;
                    if (rightElement && palmData.elementReadings[rightElement]) {
                        readingHtml += '<h4 class="text-lg font-semibold mt-6 mb-2">Right Hand Element</h4>';
                        readingHtml += palmData.elementReadings[rightElement];
                    }
                    
                    if (elementReadingResult) {
                        elementReadingResult.innerHTML = readingHtml;
                        elementReadingResult.classList.remove('hidden');
                        revealElementalHandInsightsButton.classList.add('hidden');
                    }
                });
            }

            if (getAstroReadingButton) {
                getAstroReadingButton.addEventListener('click', () => {
                    console.log('Getting astro reading');
                    const selectedSign = astrologicalSignSelect.value;
                    if (!selectedSign) {
                        alert('Please select your astrological sign first.');
                        return;
                    }
                    
                    const signElement = palmData.astrologicalSignToElement[selectedSign];
                    let readingHtml = '';
                    
                    // Add left hand astro-element interaction
                    const leftElement = userSelections.elementHand.left;
                    if (leftElement && palmData.astroSignInteractions[leftElement][signElement]) {
                        readingHtml += '<h4 class="text-lg font-semibold mb-2">Left Hand & Astrological Influence</h4>';
                        readingHtml += `<p>${palmData.astroSignInteractions[leftElement][signElement]}</p>`;
                    }
                    
                    // Add right hand astro-element interaction
                    const rightElement = userSelections.elementHand.right;
                    if (rightElement && palmData.astroSignInteractions[rightElement][signElement]) {
                        readingHtml += '<h4 class="text-lg font-semibold mt-6 mb-2">Right Hand & Astrological Influence</h4>';
                        readingHtml += `<p>${palmData.astroSignInteractions[rightElement][signElement]}</p>`;
                    }
                    
                    if (astroReadingResult) {
                        astroReadingResult.innerHTML = readingHtml;
                        astroReadingResult.classList.remove('hidden');
                    }
                });
            }

            if (scanAgainButton) {
                scanAgainButton.addEventListener('click', () => {
                    console.log('Starting new reading');
                    resetAppState();
                    showScreen(welcomeScreen);
                });
            }

            // Tab navigation
            [tabPalmLines, tabElement, tabAstro].forEach(tab => {
                if (tab) {
                    tab.addEventListener('click', () => {
                        console.log('Tab clicked:', tab.id);
                        switch(tab.id) {
                            case 'tabPalmLines':
                                setActiveTab(tabPalmLines, palmLinesContent);
                                break;
                            case 'tabElement':
                                setActiveTab(tabElement, elementTypeContent);
                                break;
                            case 'tabAstro':
                                setActiveTab(tabAstro, astroPalmistryContent);
                                break;
                        }
                    });
                }
            });
        });
    </script>
</body>
</html>